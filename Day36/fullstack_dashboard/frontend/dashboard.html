<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>User Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main class="card-container">
    <h1>Willkommen!</h1>
    <p>Sie sind erfolgreich eingeloggt.</p>
    <section id="profile-data" class="card">
        <h2>Ihr Profil</h2>
        <p><strong>Username:</strong> <span id="username"></span></p>
        <p><strong>E-Mail:</strong> <span id="email"></span></p>
        <p><strong>Registriert seit:</strong> <span id="created_at"></span></p>
    </section>
    <button id="logoutBtn" onclick="logout()">Logout</button>
  </main>

  <script>
    const API = "http://127.0.0.1:8000";

    async function getUserData() {
      // ðŸŽ¯ KORREKTUR 3: Token wird unter 'access_token' abgerufen
      const token = localStorage.getItem("access_token");
      if (!token) return window.location.href = "index.html"; 

      // ðŸŽ¯ KORREKTUR 4: Abruf der Benutzerdaten vom geschÃ¼tzten Endpunkt
      const response = await fetch(`${API}/users/me`, {
        headers: { "Authorization": "Bearer " + token }
      });

      if (response.ok) {
        const user = await response.json();
        // Daten in die HTML-Felder einfÃ¼gen
        document.getElementById("username").innerText = user.username;
        document.getElementById("email").innerText = user.email;
        document.getElementById("created_at").innerText = new Date(user.created_at).toLocaleDateString();
      } else {
        // Wenn Token ungÃ¼ltig, zur Login-Seite zurÃ¼ckleiten
        localStorage.removeItem("access_token");
        window.location.href = "index.html";
      }
    }

    function logout() {
      localStorage.removeItem("access_token");
      window.location.href = "index.html";
    }

    getUserData();
  </script>
</body>
</html>