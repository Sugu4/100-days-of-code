<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Todo</title>
  <meta name="description" content="Einfache Todo-App mit Unteraufgaben, Filtern und Speicherung im Browser (LocalStorage).">

  <link rel="icon" type="image/png" href="assets/WebMÂ®Â®Â®32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="assets/WebMÂ®Â®Â®16.png" sizes="16x16">
  <link rel="shortcut icon" href="assets/WebMÂ®Â®Â®.svg">

  <style>
    :root {
      --bg: #0a192f;
      --card: #112240;
      --accent: #64ffda;
      --danger: #ff4d6d;
      --text: #e6f1ff;
      --muted: #8892b0;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    .app {
      max-width: 900px;
      margin: auto;
      padding: 24px;
    }

    h1 {
      text-align: center;
      color: var(--accent);
      margin-bottom: 20px;
    }

    form {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    input {
      flex: 1;
      padding: 14px;
      border-radius: 10px;
      border: 1px solid var(--accent);
      background: var(--card);
      color: var(--text);
      font-size: 16px;
    }

    input::placeholder {
      color: var(--muted);
    }

    button {
      padding: 14px 18px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-size: 16px;
      background: var(--accent);
      color: #000;
      transition: background 0.15s ease, transform 0.05s ease;
    }

    button:hover {
      background: #75ffe0;
      transform: translateY(-1px);
    }

    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
    }

    .filters button {
      background: transparent;
      color: var(--accent);
      border: 1px solid var(--accent);
    }

    .filters button.active {
      background: var(--accent);
      color: #000;
    }

    .todo-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 65vh;
      overflow-y: auto;
    }

    .todo {
      background: var(--card);
      border-radius: 12px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .todo-header {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .todo-header span[contenteditable] {
      flex: 1;
      outline: none;
      min-height: 1.2em;
    }

    .todo.completed span {
      text-decoration: line-through;
      color: var(--muted);
    }

    .actions {
      display: flex;
      gap: 8px;
    }

    .actions button {
      background: transparent;
      border: 1px solid var(--accent);
      color: var(--accent);
      min-width: 42px;
      min-height: 42px;
    }

    .actions .delete {
      border-color: var(--danger);
      color: var(--danger);
    }

    .subtasks {
      margin-left: 24px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    @media (max-width: 600px) {
      .todo-header {
        align-items: flex-start;
      }

      .actions {
        flex-wrap: wrap;
        justify-content: flex-end;
      }
    }
  </style>
</head>

<body>
  <div class="app">
    <h1>Todo</h1>

    <form id="form">
      <input id="input" placeholder="Neue Aufgabe..." autocomplete="off">
      <button type="submit" aria-label="Aufgabe hinzufÃ¼gen">+</button>
    </form>

    <div class="filters" aria-label="Filter">
      <button type="button" data-filter="all" class="active">Alle</button>
      <button type="button" data-filter="open">Offen</button>
      <button type="button" data-filter="done">Erledigt</button>
    </div>

    <div class="todo-list" id="list"></div>
  </div>

  <script>
    let todos = [];

    try {
      const stored = localStorage.getItem('todos');
      todos = stored ? JSON.parse(stored) : [];
    } catch {
      localStorage.removeItem('todos');
      todos = [];
    }

    todos = todos.map(t => ({
      text: t.text ?? '',
      done: Boolean(t.done),
      subs: Array.isArray(t.subs) ? t.subs : []
    }));

    let filter = 'all';

    const list = document.getElementById('list');
    const input = document.getElementById('input');
    const form = document.getElementById('form');
    const filterButtons = document.querySelectorAll('.filters button');

    form.addEventListener('submit', e => {
      e.preventDefault();
      const value = input.value.trim();
      if (!value) return;

      todos.push({ text: value, done: false, subs: [] });
      input.value = '';
      save();
    });

    filterButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        filter = btn.dataset.filter;
        filterButtons.forEach(b => b.classList.toggle('active', b === btn));
        render();
      });
    });

    function save() {
      localStorage.setItem('todos', JSON.stringify(todos));
      render();
    }

    function render() {
      list.innerHTML = '';

      todos
        .filter(t =>
          filter === 'all' ||
          (filter === 'done' && t.done) ||
          (filter === 'open' && !t.done)
        )
        .forEach((t, i) => {
          const el = document.createElement('div');
          el.className = 'todo' + (t.done ? ' completed' : '');

          el.innerHTML = `
            <div class="todo-header">
              <span contenteditable="true"
                    onblur="edit(${i}, this.innerText)"
                    aria-label="Aufgabentext bearbeiten">${t.text}</span>
              <div class="actions">
                <button type="button" onclick="toggle(${i})" aria-label="Aufgabe erledigt umschalten">âœ“</button>
                <button type="button" onclick="addSub(${i})" aria-label="Unteraufgabe hinzufÃ¼gen">ï¼‹</button>
                <button type="button" class="delete" onclick="del(${i})" aria-label="Aufgabe lÃ¶schen">ðŸ—‘</button>
              </div>
            </div>
            <div class="subtasks">
              ${t.subs.map((s, si) => `
                <div class="todo ${s.done ? 'completed' : ''}">
                  <div class="todo-header">
                    <span contenteditable="true"
                          onblur="editSub(${i}, ${si}, this.innerText)"
                          aria-label="Unteraufgabe bearbeiten">${s.text}</span>
                    <div class="actions">
                      <button type="button" onclick="toggleSub(${i}, ${si})" aria-label="Unteraufgabe erledigt umschalten">âœ“</button>
                      <button type="button" class="delete" onclick="delSub(${i}, ${si})" aria-label="Unteraufgabe lÃ¶schen">ðŸ—‘</button>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          `;
          list.appendChild(el);
        });
    }

    function toggle(i) {
      todos[i].done = !todos[i].done;
      save();
    }

    function del(i) {
      todos.splice(i, 1);
      save();
    }

    function edit(i, t) {
      t = t.trim();
      if (!t) t = 'Unbenannte Aufgabe';
      todos[i].text = t;
      save();
    }

    function addSub(i) {
      const text = prompt('Unteraufgabe:');
      if (!text) return;
      const trimmed = text.trim();
      if (!trimmed) return;
      todos[i].subs.push({ text: trimmed, done: false });
      save();
    }

    function toggleSub(i, si) {
      todos[i].subs[si].done = !todos[i].subs[si].done;
      save();
    }

    function delSub(i, si) {
      todos[i].subs.splice(si, 1);
      save();
    }

    function editSub(i, si, t) {
      t = t.trim();
      if (!t) t = 'Unbenannte Unteraufgabe';
      todos[i].subs[si].text = t;
      save();
    }

    render();
  </script>
</body>
</html>
